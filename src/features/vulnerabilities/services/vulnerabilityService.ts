"use server";

import prisma from "@/shared/lib/prisma";
import { VulnerabilityStatus } from "../types";

export async function getVulnerabilities() {
    return await prisma.vulnerability.findMany({
        orderBy: { severity: 'desc' },
        include: {
            asset: {
                select: {
                    name: true,
                    criticality: true
                }
            }
        }
    });
}

export async function updateVulnerabilityStatus(id: string, status: VulnerabilityStatus) {
    return await prisma.vulnerability.update({
        where: { id },
        data: {
            status,
            mitigatedAt: status === 'MITIGADA' ? new Date() : null
        },
        include: {
            asset: {
                select: {
                    name: true,
                    criticality: true
                }
            }
        }
    });
}
